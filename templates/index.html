<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cegah Stunting - Info & Chatbot Kesehatan</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* ... (Semua CSS dari kode sebelumnya tetap di sini) ... */
      body {
        background-color: #f4f7f6;
        padding-top: 70px; /* Tambahan padding untuk navbar fixed-top */
      }
      .hero {
        background-color: #dff0e8;
        padding: 4rem 0;
        border-radius: 15px;
      }
      .info-card {
        background-color: #ffffff;
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
      }
      .info-card:hover {
        transform: translateY(-5px);
      }
      .info-card .card-body {
        padding: 2rem;
      }
      .info-card i {
        font-size: 2.5rem;
        margin-bottom: 1rem;
      }
      .text-primary-green {
        color: #006a4e;
      }
      .text-secondary-green {
        color: #4caf50;
      }
      #chatbot-toggler {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background-color: #006a4e;
        color: white;
        border-radius: 50%;
        font-size: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        z-index: 1000;
      }
      #chatbot-container {
        position: fixed;
        bottom: 100px;
        right: 30px;
        width: 350px;
        height: 500px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        z-index: 999;
        transform: scale(0);
        transform-origin: bottom right;
        transition: transform 0.3s ease;
      }
      #chatbot-container.show {
        transform: scale(1);
      }
      #chat-header {
        background-color: #006a4e;
        color: white;
        padding: 1rem;
        text-align: center;
        font-weight: bold;
      }
      #chat-window {
        flex-grow: 1;
        padding: 1rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
      }
      .chat-message {
        max-width: 80%;
        padding: 0.5rem 1rem;
        border-radius: 10px;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
      }
      .user-message {
        background-color: #e1f5fe;
        color: #01579b;
        align-self: flex-end;
      }
      .bot-message {
        background-color: #f1f1f1;
        color: #333;
        align-self: flex-start;
      }
      .bot-message.loading {
        background-color: #f1f1f1;
        color: #999;
        font-style: italic;
      }
      #chat-input-form {
        display: flex;
        border-top: 1px solid #ddd;
        padding: 0.5rem;
      }
      #chat-input-form input {
        flex-grow: 1;
        border: none;
        padding: 0.75rem;
        border-radius: 20px;
        background-color: #f9f9f9;
        margin-right: 0.5rem;
      }
      #chat-input-form input:focus {
        outline: none;
        box-shadow: 0 0 0 2px #006a4e;
      }
      #chat-input-form button {
        border: none;
        background: #006a4e;
        color: white;
        border-radius: 50%;
        width: 45px;
        height: 45px;
      }
    </style>
  </head>
  <body class="bg-light">
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top shadow-sm"
    >
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">
          <i class="fas fa-child me-2"></i>Cegah Stunting
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/dashboard">Dashboard Pasien</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/login">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link btn btn-primary text-white" href="/register"
                >Register</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/logout">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ category }} alert-dismissible fade show mt-3"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}
    </div>

    <div class="container my-5">
      <div class="text-center p-5 hero">
        <h1 class="display-4 fw-bold text-primary-green">Cegah Stunting</h1>
        <p class="lead col-lg-8 mx-auto">
          Wujudkan Generasi Sehat Bebas Stunting. Temukan informasi lengkap
          mengenai pencegahan, gizi, dan nutrisi untuk buah hati Anda.
        </p>
      </div>
    </div>

    <div class="container py-5">
      <h2 class="text-center mb-5 fw-bold text-primary-green">
        Mengenal & Mencegah Stunting
      </h2>
      <div class="row g-4">
        <div class="col-md-4">
          <div class="card info-card h-100">
            <div class="card-body text-center">
              <i class="fas fa-child text-secondary-green"></i>
              <h5 class="card-title fw-bold mt-3">Apa itu Stunting?</h5>
              <p class="card-text">
                Stunting adalah kondisi gagal tumbuh pada anak balita akibat
                kekurangan gizi kronis, sehingga anak lebih pendek dari standar
                usianya.
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card info-card h-100">
            <div class="card-body text-center">
              <i class="fas fa-heartbeat text-danger"></i>
              <h5 class="card-title fw-bold mt-3">Kunci Pencegahan</h5>
              <p class="card-text">
                Fokus pada 1000 Hari Pertama Kehidupan (HPK), penuhi gizi ibu
                hamil, berikan ASI eksklusif, dan pastikan MPASI berkualitas.
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card info-card h-100">
            <div class="card-body text-center">
              <i class="fas fa-utensils text-primary"></i>
              <h5 class="card-title fw-bold mt-3">Gizi Seimbang</h5>
              <p class="card-text">
                Pastikan anak mendapatkan asupan protein hewani (telur, ikan,
                ayam), lemak sehat, vitamin, dan mineral yang cukup setiap hari.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button id="chatbot-toggler">
      <i class="fas fa-comments"></i>
    </button>

    <div id="chatbot-container">
      <div id="chat-header">Sahabat Gizi</div>
      <div id="chat-window">
        <div class="chat-message bot-message">
          Halo! Saya Sahabat Gizi. Ada yang bisa saya bantu seputar stunting
          atau gizi anak?
        </div>
      </div>
      <form id="chat-input-form">
        <input
          type="text"
          id="user-input"
          placeholder="Ketik pertanyaan Anda..."
          autocomplete="off"
          required
        />
        <button type="submit"><i class="fas fa-paper-plane"></i></button>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // ... (Semua JavaScript untuk Chatbot tetap di sini) ...
      const chatbotToggler = document.getElementById("chatbot-toggler");
      const chatbotContainer = document.getElementById("chatbot-container");
      const chatForm = document.getElementById("chat-input-form");
      const userInput = document.getElementById("user-input");
      const chatWindow = document.getElementById("chat-window");

      chatbotToggler.addEventListener("click", () => {
        chatbotContainer.classList.toggle("show");
      });

      function appendMessage(sender, message) {
        const messageDiv = document.createElement("div");
        messageDiv.classList.add("chat-message", `${sender}-message`);
        messageDiv.textContent = message;
        chatWindow.appendChild(messageDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      function showLoadingIndicator() {
        const loadingDiv = document.createElement("div");
        loadingDiv.classList.add("chat-message", "bot-message", "loading");
        loadingDiv.textContent = "Sahabat Gizi sedang mengetik...";
        loadingDiv.id = "loading-indicator";
        chatWindow.appendChild(loadingDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
      }

      function removeLoadingIndicator() {
        const loadingDiv = document.getElementById("loading-indicator");
        if (loadingDiv) {
          loadingDiv.remove();
        }
      }

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = userInput.value.trim();
        if (!message) return;
        appendMessage("user", message);
        userInput.value = "";
        showLoadingIndicator();
        try {
          const response = await fetch("/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ message: message }),
          });
          removeLoadingIndicator();
          if (!response.ok) {
            throw new Error("Gagal mendapatkan respons.");
          }
          const data = await response.json();
          appendMessage("bot", data.response);
        } catch (error) {
          console.error("Error:", error);
          removeLoadingIndicator();
          appendMessage(
            "bot",
            "Maaf, terjadi kesalahan. Silakan coba lagi nanti."
          );
        }
      });
    </script>
  </body>
</html>
